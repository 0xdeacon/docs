---
sidebar_label: Deploy to Ethermint
---

# Deploy A Solidity Smart Contract on Ethermint Sovereign Rollup with Foundry

In this guide you'll learn how to deploy a Solidity smart contract to
the Ethermint chain you just instantiated on Celestia with
[Foundry](https://github.com/foundry-rs/foundry).

## About Foundry

Foundry is a portable, fast and modular toolkit for Ethereum application development.

Foundry is made up of three components:

- [__Forge__](https://github.com/foundry-rs/foundry/tree/master/forge) - Ethereum
 testing framework (like Truffle, Hardhat and DappTools).
- [__Cast__](https://github.com/foundry-rs/foundry/tree/master/cast) - CLI for
interacting with EVM smart contracts, sending transactions, and getting chain data.
- [__Anvil__](https://github.com/foundry-rs/foundry/tree/master/anvil) - Local
Ethereum node, similar to Ganache or Hardhat Network.

We'll use all three to create, test, and deploy our Solidity project.

> To learn more about Foundry, check out the [Foundry Book](https://book.getfoundry.sh).

## Getting started

### Initialize development environment

First, be sure to
[install Foundry](https://book.getfoundry.sh/getting-started/installation.html)
on your local development environment.

Next, create a new project and change into the directory:

```sh
forge init celestia-ethermint-app
cd celestia-ethermint-app
```

Foundry has created an example smart contract located at `src/Counter.sol`.

### Updating the contract and tests

Let's update the contracts to include a basic counter example. Open the
`Counter.sol` file in the `src` directory and add the following code:

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.13;

contract Counter {
    int private count;
    
    constructor(int _count) {
        count = _count;
    }

    function incrementCounter() public {
        count += 1;
    }
    function decrementCounter() public {
        count -= 1;
    }

    function getCount() public view returns (int) {
        return count;
    }
}
```

Next, let's create a test for this contract.

Open `test/Counter.T.Sol` and update the code with the following:

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.13;

import "forge-std/Test.sol";
import 'src/Counter.sol';

contract CounterTest is Test {
    Counter counter;
    function setUp() public {
        counter = new Counter(10);
    }

    function testGetCount() public {
        int value = counter.getCount();
        assertEq(value, 10);
        emit log_int(value);
    }

    function testIncrement() public {
        counter.incrementCounter();
        counter.incrementCounter();
        int value = counter.getCount();
        assertEq(value, 12);
        emit log_int(value);
    }

    function testDecrement() public {
        counter.decrementCounter();
        int value = counter.getCount();
        assertEq(value, 9);
        emit log_int(value);
    }
}
```

Foundry uses [Dappsys Test](https://book.getfoundry.sh/reference/ds-test.html) to
provide basic logging and assertion functionality. It's included in the Forge
Standard Library.

Here, we are using `assertEq` to assert equality. You can view all of the assertion
functions available
[here](https://book.getfoundry.sh/reference/ds-test.html?highlight=log_int#asserting).

Next, we can test the contract using __Forge__ with the following command:

```sh
forge test -vv
```

A successful test will have output similar to the following:

```sh
[⠊] Compiling...
[⠰] Installing solc version 0.8.17
[⠒] Successfully installed solc 0.8.17
[⠆] Compiling 18 files with 0.8.17
[⠑] Solc 0.8.17 finished in 3.59s
Compiler run successful

Running 3 tests for test/Counter.t.sol:ContractTest
[PASS] testDecrement() (gas: 12350)
Logs:
  9

[PASS] testGetCount() (gas: 8510)
Logs:
  10

[PASS] testIncrement() (gas: 13285)
Logs:
  12

Test result: ok. 3 passed; 0 failed; finished in 2.24ms
```

### Updating the deployment script

Now that we've tested the contract, let's try deploying it locally using
[Solidity Scripting](https://book.getfoundry.sh/tutorials/solidity-scripting.html).

To do so, update the deloyment script at `script/Counter.s.sol` with the
following code:

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.13;

import "forge-std/Script.sol";

import {Counter} from "src/Counter.sol";

contract CounterScript is Script {
    function setUp() public {}

    function run() public {
        vm.startBroadcast();
        new Counter(10);
        vm.stopBroadcast();
    }
}
```

Now we can use this script to deploy our smart contract to either a live or
test network.

### Deploying locally

Next start Anvil, the local testnet:

```sh
anvil --port 9545
```

Once started, Anvil will give you a local RPC endpoint as well as a handful
of Private Keys and Accounts that you can use.

Set `ANVIL_KEY` with one of the private keys generated by running:

```sh
export ANVIL_KEY=<anvil-private-key>
```

And set the RPC URL as an environment variable:

```sh
export RPC_URL=http://127.0.0.1:9545
```

We can now use the local RPC along with one of the private keys to deploy locally:

```sh
forge script script/Counter.s.sol:CounterScript --fork-url \
$RPC_URL  --private-key $ANVIL_KEY --broadcast
```

Once the contract has been deployed locally, Anvil will log out the contract address.

Next, set the contract address as an environment variable:

```sh
export CONTRACT_ADDRESS=<contract-address>
```

We can then test sending transactions to it with `cast send`.

```sh
cast send $CONTRACT_ADDRESS "incrementCounter()" \
--private-key $ANVIL_KEY --rpc-url $RPC_URL
```

We can then perform read operations with `cast call`:

```sh
cast call $CONTRACT_ADDRESS "getCount()(int)" --rpc-url $RPC_URL
```

### Deploying to the Ethermint Sovereign Rollup

Now that we've deployed and tested locally, we can deploy to our
Ethermint chain.

First, we will need to export the private key generated by
the ethermint `init.sh` script:

```sh
PRIVATE_KEY=$(ethermintd keys unsafe-export-eth-key mykey --keyring-backend test)
```

> NOTE: Here, the key name from `init.sh` is `mykey` but you can modify
  the `init.sh` to change the name of your key.

Now, we can start deploying the smart contract to our Ethermint chain.

To do so, run the following script:

```sh
forge script script/Counter.s.sol:CounterScript \
--rpc-url http://localhost:8545 --private-key $PRIVATE_KEY --broadcast
```

Set the contract address in the output as the `CONTRACT_ADDRESS` variable:

```sh
export CONTRACT_ADDRESS=<new-contract-address>
```

Once the contract has been deployed to the Ethermint rollup, we can
use `cast send` to test sending transactions to it:

```sh
cast send $CONTRACT_ADDRESS "incrementCounter()" \
--rpc-url http://localhost:8545 --private-key $PRIVATE_KEY 
```

We can then perform read operations with `cast call`:

```sh
cast call $CONTRACT_ADDRESS "getCount()(int)" --rpc-url http://localhost:8545
```
