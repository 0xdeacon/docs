"use strict";(self.webpackChunkcelestia_docs=self.webpackChunkcelestia_docs||[]).push([[6622],{3905:function(e,t,r){r.d(t,{Zo:function(){return p},kt:function(){return d}});var n=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var s=n.createContext({}),u=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},p=function(e){var t=u(e.components);return n.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),c=u(r),d=o,g=c["".concat(s,".").concat(d)]||c[d]||m[d]||a;return r?n.createElement(g,l(l({ref:t},p),{},{components:r})):n.createElement(g,l({ref:t},p))}));function d(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=r.length,l=new Array(a);l[0]=c;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:o,l[1]=i;for(var u=2;u<a;u++)l[u]=r[u];return n.createElement.apply(null,l)}return n.createElement.apply(null,r)}c.displayName="MDXCreateElement"},2431:function(e,t,r){r.r(t),r.d(t,{assets:function(){return s},contentTitle:function(){return l},default:function(){return m},frontMatter:function(){return a},metadata:function(){return i},toc:function(){return u}});var n=r(3117),o=(r(7294),r(3905));const a={sidebar_label:"Query your Rollup"},l="\ud83d\udcac Dites \u201cBonjour tout le monde !\u201d",i={unversionedId:"developers/gm-query",id:"developers/gm-query",title:"\ud83d\udcac Dites \u201cBonjour tout le monde !\u201d",description:"Now, we\u2019re going to get our blockchain to say gm world and in order to do so we need to make the following changes:",source:"@site/i18n/fr/docusaurus-plugin-content-docs/current/developers/gm-query.md",sourceDirName:"developers",slug:"/developers/gm-query",permalink:"/fr/developers/gm-query",draft:!1,editUrl:"https://github.com/celestiaorg/docs/tree/main/docs/developers/gm-query.md",tags:[],version:"current",frontMatter:{sidebar_label:"Query your Rollup"},sidebar:"developers",previous:{title:"Build a Sovereign Rollup",permalink:"/fr/developers/gm-rollmint"},next:{title:"What's next",permalink:"/fr/developers/gm-next"}},s={},u=[{value:"\u270b Cr\xe9ez votre premi\xe8re requ\xeate",id:"-cr\xe9ez-votre-premi\xe8re-requ\xeate",level:2},{value:"\ud83d\udce8\xa0Query request and response types",id:"query-request-and-response-types",level:2},{value:"\ud83d\udc4b\xa0Gm keeper function",id:"gm-keeper-function",level:2},{value:"\ud83d\udfe2 Commencez votre Rollup souverain",id:"-commencez-votre-rollup-souverain",level:2}],p={toc:u};function m(e){let{components:t,...a}=e;return(0,o.kt)("wrapper",(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"-dites-bonjour-tout-le-monde-"},"\ud83d\udcac Dites \u201cBonjour tout le monde !\u201d"),(0,o.kt)("p",null,"Now, we\u2019re going to get our blockchain to say ",(0,o.kt)("inlineCode",{parentName:"p"},"gm world")," and in order to do so we need to make the following changes:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Modify a protocol buffer file"),(0,o.kt)("li",{parentName:"ul"},"Create a keeper query function that returns data"),(0,o.kt)("li",{parentName:"ul"},"Register a query function")),(0,o.kt)("p",null,"Protocol buffer files contain proto RPC calls that define Cosmos SDK queries and message handlers, and proto messages that define Cosmos SDK types. The RPC calls are also responsible for exposing an HTTP API."),(0,o.kt)("p",null,"The Keeper is required for each Cosmos SDK module and is an abstraction for modifying the state of the blockchain. Keeper functions allow you to query or write to the state. After you add a query to your chain, you need to register the query. Vous n'aurez besoin d'enregistrer une requ\xeate qu'une seule fois."),(0,o.kt)("p",null,"The typical Cosmos blockchain developer workflow looks something like this:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Commencez par les fichiers .proto pour d\xe9finir les ",(0,o.kt)("a",{parentName:"li",href:"https://docs.cosmos.network/master/building-modules/msg-services.html"},"messages")," CosmosSDK"),(0,o.kt)("li",{parentName:"ul"},"D\xe9finir et enregistrer des ",(0,o.kt)("a",{parentName:"li",href:"https://docs.cosmos.network/master/building-modules/query-services.html"},"requ\xeates")),(0,o.kt)("li",{parentName:"ul"},"D\xe9finir la logique du gestionnaire de message"),(0,o.kt)("li",{parentName:"ul"},"Enfin impl\xe9mentez la logique de ces requ\xeates et de ces gestionnaires de messages dans les fonctions keeper")),(0,o.kt)("h2",{id:"-cr\xe9ez-votre-premi\xe8re-requ\xeate"},"\u270b Cr\xe9ez votre premi\xe8re requ\xeate"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Pour cette partie du tutoriel, ouvrez une nouvelle fen\xeatre de terminal qui n'est pas la m\xeame que celle dans laquelle vous avez d\xe9marr\xe9 la cha\xeene.")),(0,o.kt)("p",null,"Dans votre nouveau terminal, ",(0,o.kt)("inlineCode",{parentName:"p"},"cd")," dans le r\xe9pertoire ",(0,o.kt)("inlineCode",{parentName:"p"},"gm")," et ex\xe9cutez cette commande pour cr\xe9er la requ\xeate ",(0,o.kt)("inlineCode",{parentName:"p"},"gm")," :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"ignite scaffold query gm --response text\n")),(0,o.kt)("p",null,"R\xe9ponse :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"modify proto/gm/query.proto\nmodify x/gm/client/cli/query.go\ncreate x/gm/client/cli/query_gm.go\ncreate x/gm/keeper/grpc_query_gm.go\n\n\ud83c\udf89 Cr\xe9er une requ\xeate `gm`.\n")),(0,o.kt)("p",null,"Que vient-il d'arriver ? ",(0,o.kt)("inlineCode",{parentName:"p"},"query")," accepts the name of the query (",(0,o.kt)("inlineCode",{parentName:"p"},"gm"),"), an optional list of request parameters (empty in this tutorial), and an optional comma-separated list of response field with a ",(0,o.kt)("inlineCode",{parentName:"p"},"--response")," flag (",(0,o.kt)("inlineCode",{parentName:"p"},"text")," in this tutorial)."),(0,o.kt)("p",null,"Navigate to the ",(0,o.kt)("inlineCode",{parentName:"p"},"gm/proto/gm/query.proto")," file, you\u2019ll see that ",(0,o.kt)("inlineCode",{parentName:"p"},"Gm")," RPC has been added to the ",(0,o.kt)("inlineCode",{parentName:"p"},"Query")," service:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-protobuf",metastring:'title="gm/proto/gm/query.proto"',title:'"gm/proto/gm/query.proto"'},'service Query {\n  rpc Params(QueryParamsRequest) returns (QueryParamsResponse) {\n    option (google.api.http).get = "/gm/gm/params";\n  }\n    rpc Gm(QueryGmRequest) returns (QueryGmResponse) {\n        option (google.api.http).get = "/gm/gm/gm";\n    }\n}\n')),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"Gm")," RPC for the ",(0,o.kt)("inlineCode",{parentName:"p"},"Query")," service:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"is responsible for returning a ",(0,o.kt)("inlineCode",{parentName:"li"},"text")," string"),(0,o.kt)("li",{parentName:"ul"},"Accepts request parameters (",(0,o.kt)("inlineCode",{parentName:"li"},"QueryGmRequest"),")"),(0,o.kt)("li",{parentName:"ul"},"Returns response of type ",(0,o.kt)("inlineCode",{parentName:"li"},"QueryGmResponse")),(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("inlineCode",{parentName:"li"},"option")," defines the endpoint that is used by gRPC to generate an HTTP API")),(0,o.kt)("h2",{id:"query-request-and-response-types"},"\ud83d\udce8\xa0Query request and response types"),(0,o.kt)("p",null,"Dans le m\xeame fichier, nous trouverons :"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"QueryGmRequest")," is empty because it does not require parameters"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"QueryGmResponse")," contains ",(0,o.kt)("inlineCode",{parentName:"li"},"text")," that is returned from the chain")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-protobuf",metastring:'title="gm/proto/gm/query.proto"',title:'"gm/proto/gm/query.proto"'},"message QueryGmRequest {\n}\n\nmessage QueryGmResponse {\n  string text = 1;\n}\n")),(0,o.kt)("h2",{id:"gm-keeper-function"},"\ud83d\udc4b\xa0Gm keeper function"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"gm/x/gm/keeper/grpc_query_gm.go")," file contains the ",(0,o.kt)("inlineCode",{parentName:"p"},"Gm")," keeper function that handles the query and returns data."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go",metastring:'title="gm/x/gm/keeper/grpc_query_gm.go"',title:'"gm/x/gm/keeper/grpc_query_gm.go"'},'func (k Keeper) Gm(goCtx context.Context, req *types.QueryGmRequest) (*types.QueryGmResponse, error) {\n    if req == nil {\n        return nil, status.Error(codes.InvalidArgument, "invalid request")\n    }\n    ctx := sdk.UnwrapSDKContext(goCtx)\n    _ = ctx\n    return &types.QueryGmResponse{}, nil\n}\n')),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"Gm")," function performs the following actions:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Makes a basic check on the request and throws an error if it\u2019s ",(0,o.kt)("inlineCode",{parentName:"li"},"nil")),(0,o.kt)("li",{parentName:"ul"},"Stores context in a ",(0,o.kt)("inlineCode",{parentName:"li"},"ctx")," variable that contains information about the environment of the request"),(0,o.kt)("li",{parentName:"ul"},"Returns a response of type ",(0,o.kt)("inlineCode",{parentName:"li"},"QueryGmResponse"))),(0,o.kt)("p",null,"Actuellement, la r\xe9ponse est vide. Let\u2019s update the keeper function."),(0,o.kt)("p",null,"Our ",(0,o.kt)("inlineCode",{parentName:"p"},"query.proto")," file defines that the response accepts ",(0,o.kt)("inlineCode",{parentName:"p"},"text"),". Use your text editor to modify the keeper function in ",(0,o.kt)("inlineCode",{parentName:"p"},"gm/x/gm/keeper/grpc_query_gm.go")," ."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go",metastring:'title="gm/x/gm/keeper/grpc_query_gm.go"',title:'"gm/x/gm/keeper/grpc_query_gm.go"'},'func (k Keeper) Gm(goCtx context.Context, req *types.QueryGmRequest) (*types.QueryGmResponse, error) {\n    if req == nil {\n        return nil, status.Error(codes.InvalidArgument, "invalid request")\n    }\n    ctx := sdk.UnwrapSDKContext(goCtx)\n    _ = ctx\n    return &types.QueryGmResponse{Text: "gm world!"}, nil\n}\n')),(0,o.kt)("h2",{id:"-commencez-votre-rollup-souverain"},"\ud83d\udfe2 Commencez votre Rollup souverain"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'gmd start --rollmint.aggregator true --rollmint.da_layer celestia --rollmint.da_config=\'{"base_url":"[http://localhost:26658](http://134.209.70.139:26658/)","timeout":60000000000,"gas_limit":6000000}\' --rollmint.namespace_id 000000000000FFFF --rollmint.da_start_height 100783\n')),(0,o.kt)("p",null,"The\xa0",(0,o.kt)("inlineCode",{parentName:"p"},"query"),"\xa0command has also scaffolded ",(0,o.kt)("inlineCode",{parentName:"p"},"x/gm/client/cli/query_gm.go"),"\xa0that implements a CLI equivalent of the gm query and mounted this command in ",(0,o.kt)("inlineCode",{parentName:"p"},"x/gm/client/cli/query.go"),". Ex\xe9cutez la commande suivante et obtenez la r\xe9ponse JSON suivante :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"gmd q gm gm\n")),(0,o.kt)("p",null,"R\xe9ponse:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"text: gm world!\n")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"4.png",src:r(6986).Z,width:"1064",height:"862"})),(0,o.kt)("p",null,"F\xe9licitations \ud83c\udf89 vous avez r\xe9ussi \xe0 construire votre premier rollup et \xe0 l'interroger avec succ\xe8s !"))}m.isMDXComponent=!0},6986:function(e,t,r){t.Z=r.p+"assets/images/4-856eac0d6cc770f822920d687f38f9e7.png"}}]);