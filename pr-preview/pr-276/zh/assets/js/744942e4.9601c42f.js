"use strict";(self.webpackChunkcelestia_docs=self.webpackChunkcelestia_docs||[]).push([[2236],{3905:function(e,t,r){r.d(t,{Zo:function(){return d},kt:function(){return h}});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var s=n.createContext({}),p=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},d=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=p(r),h=a,m=c["".concat(s,".").concat(h)]||c[h]||u[h]||o;return r?n.createElement(m,i(i({ref:t},d),{},{components:r})):n.createElement(m,i({ref:t},d))}));function h(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,i=new Array(o);i[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var p=2;p<o;p++)i[p]=r[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}c.displayName="MDXCreateElement"},641:function(e,t,r){r.r(t),r.d(t,{assets:function(){return s},contentTitle:function(){return i},default:function(){return u},frontMatter:function(){return o},metadata:function(){return l},toc:function(){return p}});var n=r(3117),a=(r(7294),r(3905));const o={},i="Celestia Hardfork Process",l={unversionedId:"nodes/hardfork-process",id:"nodes/hardfork-process",title:"Celestia Hardfork Process",description:"Blockchain networks often times need to upgrade with new features",source:"@site/docs/nodes/hardfork-process.md",sourceDirName:"nodes",slug:"/nodes/hardfork-process",permalink:"/pr-preview/pr-276/zh/nodes/hardfork-process",draft:!1,editUrl:"https://github.com/celestiaorg/docs/tree/main/docs/nodes/hardfork-process.md",tags:[],version:"current",frontMatter:{},sidebar:"nodes",previous:{title:"Resources",permalink:"/pr-preview/pr-276/zh/category/resources"},next:{title:"SystemD",permalink:"/pr-preview/pr-276/zh/nodes/systemd"}},s={},p=[{value:"General Process",id:"general-process",level:2},{value:"Cosmovisor",id:"cosmovisor",level:3},{value:"Mocha Hardfork",id:"mocha-hardfork",level:3}],d={toc:p};function u(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,n.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"celestia-hardfork-process"},"Celestia Hardfork Process"),(0,a.kt)("p",null,"Blockchain networks often times need to upgrade with new features\nwhich require coordination work among the validators prior to activating\nthe upgrades."),(0,a.kt)("p",null,"This process is called a hardfork or a network upgrade. In those events,\nthe Celestia Labs team will be coordinating with the validators on\nwhat they need to do in order to be ready for an upcoming hardfork."),(0,a.kt)("p",null,"Hardforks are not backward-compatible with older versions of the network\nsoftware which is why it is important that validators upgrade their software\nto continue validating on the network after the network upgrades."),(0,a.kt)("h2",{id:"general-process"},"General Process"),(0,a.kt)("p",null,"The general process can be broken down into several components:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Hardfork specifications and features (defined by description of features\nand code implementation of those features)."),(0,a.kt)("li",{parentName:"ul"},"Binary used to add those features (a new binary release with those features\nwill be provided by Celestia team in order for validators to upgrade\ntheir nodes to the new binary)."),(0,a.kt)("li",{parentName:"ul"},"A block number for when the network upgrades (even if validators upgrade\ntheir binary to be hardfork ready, the network upgrade does not happen right\naway, but some short time in the future at a specific block number)."),(0,a.kt)("li",{parentName:"ul"},"Testing of the features (happens on testnets first prior to activating on\nmainnet in order to ensure the network can upgrade securely).")),(0,a.kt)("p",null,"The two testnets were hardforks are deployed on are:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/pr-preview/pr-276/zh/nodes/arabica-devnet"},"Arabica")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/pr-preview/pr-276/zh/nodes/mamaki-testnet"},"Mamaki"))),(0,a.kt)("h3",{id:"cosmovisor"},"Cosmovisor"),(0,a.kt)("p",null,"We will be using Cosmovisor for upgrading our network for upcoming\nhardforks."),(0,a.kt)("p",null,"Cosmovisor is a process management tool that allows switching of binaries\nwhen a certain block is reached. You can learn more about Cosmovisor\n",(0,a.kt)("a",{parentName:"p",href:"https://docs.cosmos.network/main/tooling/cosmovisor"},"here"),"."),(0,a.kt)("p",null,"Install Cosmovisor by running the following command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"go install cosmossdk.io/tools/cosmovisor/cmd/cosmovisor@latest\n")),(0,a.kt)("p",null,"Set the environment variables:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"export DAEMON_NAME=celestia-appd\nexport DAEMON_HOME=$HOME/.celestia-app\n")),(0,a.kt)("p",null,"Now, we will go over an example hardfork scenario with two example\nbinaries."),(0,a.kt)("p",null,"The following table shows the binaries and their properties:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Version"),(0,a.kt)("th",{parentName:"tr",align:null},"Hardfork-Binary"),(0,a.kt)("th",{parentName:"tr",align:null},"Release Status"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"0.X.1"),(0,a.kt)("td",{parentName:"tr",align:null},"FALSE"),(0,a.kt)("td",{parentName:"tr",align:null},"Current Release")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"0.X.2"),(0,a.kt)("td",{parentName:"tr",align:null},"TRUE"),(0,a.kt)("td",{parentName:"tr",align:null},"New Release")))),(0,a.kt)("p",null,"Above, you can see that the example ",(0,a.kt)("inlineCode",{parentName:"p"},"celestia-app")," Version 0.X.1 is the\ncurrent release version a validator would run and it is not the\nhardfork-ready binary while the Version 0.X.2 Binary will be a new release\nthat is hardfork-ready."),(0,a.kt)("p",null,"Create the directory for the current binary Version 0.X.1\nand copy ",(0,a.kt)("inlineCode",{parentName:"p"},"celestia-appd"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"mkdir -p $DAEMON_HOME/cosmovisor/genesis/bin\ncp ./build/celestia-appd $DAEMON_HOME/cosmovisor/genesis/bin\n")),(0,a.kt)("p",null,"Now you can run Cosmovisor with the current release Version 0.X.1:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"cosmovisor run start\n")),(0,a.kt)("p",null,"Now, pull in the New Release which is version 0.X.2 of celestia-app\nseparately and build the binary for it:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"make build\n")),(0,a.kt)("p",null,"Create the new folder for the version 0.X.2 and copy it over:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"mkdir -p $DAEMON_HOME/cosmovisor/upgrades/test1/bin\ncp ./build/celestia-appd $DAEMON_HOME/cosmovisor/upgrades/test1/bin\n")),(0,a.kt)("p",null,"Now, open a new terminal window and run the commands for submitting\na governance proposal to upgrade the chain and vote on it."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"NOTE: In normal hardfork operations as a validator, you do not need\nto submit a governance proposal but rather just vote on an existing one\nsubmitted by Celestia Labs team.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"./build/celestia-appd tx gov submit-proposal software-upgrade test1 --title upgrade --description upgrade --upgrade-height 200 --from validator --yes\n./build/celestia-appd tx gov deposit 1 10000000stake --from validator --yes\n./build/celestia-appd tx gov vote 1 yes --from validator --yes\n")),(0,a.kt)("p",null,"This will cause the upgrade to happen automatically on block ",(0,a.kt)("inlineCode",{parentName:"p"},"200"),",\nwhere Cosmovisor will switch the binaries from 0.X.1 (Current Release)\nto 0.X.2 (New Release)."),(0,a.kt)("h3",{id:"mocha-hardfork"},"Mocha Hardfork"),(0,a.kt)("p",null,"Celestia is planning the Mocha Hardfork upgrade on the Mamaki Testnet.\nThis hardfork is unique as it will reset the Mamaki network to block 0\nwhile maintaining the existing state and also will rename Mamaki to Mocha."),(0,a.kt)("p",null,"The new chain-id will be ",(0,a.kt)("inlineCode",{parentName:"p"},"mocha"),"."),(0,a.kt)("p",null,"The release logs for ",(0,a.kt)("inlineCode",{parentName:"p"},"mocha")," can be found here (TBD)."),(0,a.kt)("p",null,"The most exciting feature included is setting the stage for QGB on Mocha."),(0,a.kt)("p",null,"Validators will need to generate 2 new keys in order to be QGB-ready.\nNote that for the Mocha Hardfork, QGB will not launch yet so you\ncan swap those keys after for new ones if needed. The keys needed are:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"1 EVM key"),(0,a.kt)("li",{parentName:"ul"},"1 Celestia key")),(0,a.kt)("p",null,"So, in order for this to happen, validators will need to maintain two\nnew keys in order to have a successful upgrade."),(0,a.kt)("p",null,"Those two keys will need to be added to 2 new flags on ",(0,a.kt)("inlineCode",{parentName:"p"},"celestia-app"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--evm-address"),": This flag should contain a ",(0,a.kt)("inlineCode",{parentName:"li"},"0x")," EVM address."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--orchesrator-address"),": This flag should contain a newly-generated\n",(0,a.kt)("inlineCode",{parentName:"li"},"celestia1")," Celestia address. Validators certainly can use their existing\nCelestia addresses here but it is recommended to create a new one.")))}u.isMDXComponent=!0}}]);